sudo: true
language: generic

jobs:
  include:
    - stage: build docker image
      script:
        - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
        - docker build -t $DOCKER_USERNAME/numpp:tests -f DockerfileTests .
        - docker push $DOCKER_USERNAME/numpp:tests
    - stage: tests
      script:
        - docker run --name functionality_tests $DOCKER_USERNAME/numpp:tests
        - docker exec functionality_tests make -C /usr/include/numpp/tests/functionality
    - stage: tests
      script:
        - docker run --name speed_tests vyzyv/numpp:tests
        - docker exec speed_tests make -C /usr/include/numpp/tests/speed
    - stage: deploy
      script:
        - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
        - docker build -t vyzyv/numpp:latest -f DockerfileDeploy .
        - docker push $DOCKER_USERNAME/numpp:latest
