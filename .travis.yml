# matrix:
#   - DOCKERFILE=functionality_dockerfile
#   - DOCKERFILE=speed_dockerfile

# sudo: required

# language: generic

# services:
#   - docker

# before_install:
#   - sudo apt-get update
#   - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
#   - docker build -t vyzyv/numpp:latest -f ${DOCKERFILE} .

# script:
#   - docker run vyzyv/numpp:latest

# after_success:
#   - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
#   - docker push vyzyv/numpp
sudo: true
dist: trusty
language: generic

jobs:
  include:
    -stage: build docker image
    -script:
      - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
      - docker build -t numpp_testing .
      - docker tag tests $DOCKER_USERNAME/numpp
      - docker push $DOCKER_USERNAME/numpp:tests
    # -stage: tests
    # -script:
    #   - docker run --name functionality_tests vyzyv/numpp:tests
    #   - docker exec functionality_tests make -C /usr/include/numpp/tests/functionality
    # -script:
    #   - docker run --name speed_tests vyzyv/numpp:tests
    #   - docker exec speed_tests make -C /usr/include/numpp/tests/speed

    # -stage: deploy
    #  script:
    #   - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
    #   - docker build -t numpp_testing .
    #   - docker push $DOCKER_USERNAME/numpp:latest
